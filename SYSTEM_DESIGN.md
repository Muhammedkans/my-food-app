# üöÄ FoodBey - High-End Premium Food Delivery Platform
## System Architecture & Design Document

### 1. üèóÔ∏è High-Level Architecture
**Pattern:** Modular Monolith (Scalable to Microservices)
**Infrastructure:** AWS / Cloud-native ready

```mermaid
graph TD
    UserClient[User Web App (React)] --> LB[Load Balancer]
    RestClient[Restaurant Dashboard (React)] --> LB
    AdminClient[Admin Portal (React)] --> LB
    
    LB --> API_Gateway[API Gateway / Nginx]
    
    subgraph "Backend Core (Node.js/Express)"
        AuthService[Auth Service]
        OrderService[Order Service]
        RestService[Restaurant Service]
        UserService[User Service]
        PaymentService[Payment Service]
        AIService[AI/ML Service]
        NotificationService[Socket.IO Realtime]
    end
    
    API_Gateway --> AuthService
    API_Gateway --> OrderService
    API_Gateway --> RestService
    
    OrderService --> DB[(MongoDB Cluster)]
    UserService --> DB
    RestService --> DB
    
    OrderService --> Redis[(Redis Cache)]
    
    NotificationService --> UserClient
    NotificationService --> RestClient
```

---

### 2. üóÑÔ∏è Database Schema Design (MongoDB)

#### **User Collection**
```javascript
{
  _id: ObjectId,
  auth: {
    email: String, // Indexed, Unique
    phone: String, // Indexed, Unique
    passwordHash: String,
    otpSecret: String,
    isVerified: Boolean
  },
  profile: {
    name: String,
    avatar: String, // Cloudinary URL
    preferences: {
      isVeg: Boolean,
      spiceLevel: String, // 'Low', 'Medium', 'High'
      favoriteCuisines: [String]
    }
  },
  addresses: [{
    label: String, // 'Home', 'Work'
    location: { type: 'Point', coordinates: [lon, lat] },
    details: String
  },
  wallet: {
    balance: Number,
    currency: String,
    transactions: [TransactionSchema]
  },
  meta: {
    createdAt: Date,
    lastLogin: Date,
    deviceTokens: [String]
  }
}
```

#### **Restaurant Collection**
```javascript
{
  _id: ObjectId,
  name: String,
  slug: String, // Unique for SEO
  ownerId: ObjectId, // Ref to User
  status: {
    isOpen: Boolean,
    isVerified: Boolean,
    onboardingStage: String
  },
  assets: {
    logo: String,
    coverImage: String,
    gallery: [String]
  },
  info: {
    cuisineTypes: [String],
    description: String,
    averagePreparationTime: Number, // Minutes
    costForTwo: Number
  },
  location: {
    address: String,
    geo: { type: 'Point', coordinates: [lon, lat] } // 2dsphere Index
  },
  stats: {
    rating: Number,
    reviewCount: Number,
    totalOrders: Number
  },
  menuConfig: {
    categories: [{
      _id: ObjectId,
      name: String, // 'Starters', 'Mains'
      isActive: Boolean
    }]
  }
}
```

#### **MenuItem Collection**
```javascript
{
  _id: ObjectId,
  restaurantId: ObjectId, // Indexed
  categoryId: ObjectId,
  name: String,
  description: String,
  price: Number,
  image: String,
  attributes: {
    isVeg: Boolean,
    isSpicy: Boolean,
    calories: Number,
    servingSize: String
  },
  customization: [{
    title: String, // 'Choose Crust'
    minSelection: Number,
    maxSelection: Number,
    options: [{ name: String, priceDelta: Number }]
  }],
  aiTags: [String], // 'comfort-food', 'late-night-snack' (Generated by AI)
  isAvailable: Boolean
}
```

#### **Order Collection**
```javascript
{
  _id: ObjectId,
  shortId: String, // For user reference e.g., #ORD-1234
  userId: ObjectId,
  restaurantId: ObjectId,
  items: [{
    itemId: ObjectId,
    name: String,
    quantity: Number,
    price: Number,
    customizations: [Object]
  }],
  billing: {
    itemTotal: Number,
    tax: Number,
    deliveryFee: Number,
    platformFee: Number,
    discount: Number,
    grandTotal: Number
  },
  status: {
    current: String, // 'PLACED', 'CONFIRMED', 'PREPARING', 'OUT_FOR_DELIVERY', 'DELIVERED', 'CANCELLED'
    history: [{ status: String, timestamp: Date, comment: String }]
  },
  payment: {
    transactionId: String,
    method: String, // 'UPI', 'CARD'
    status: String
  },
  delivery: {
    address: Object,
    assignedDriverId: ObjectId, // Future scope
    estimatedTime: Date
  }
}
```

---

### 3. üîå API Structure
**Base URL:** `/api/v1`

| method | endpoint | description | auth |
| item | item | item | item |
| POST | /auth/register | Register new user | Public |
| POST | /auth/login | Login | Public |
| GET | /restaurants/feed | Main feed (AI Pers.) | User |
| GET | /restaurants/:id | Get details & menu | Public |
| POST | /cart/sync | Sync local cart to DB | User |
| POST | /orders/checkout | Initiate order | User |
| POST | /orders/webhook | Razorpay Webhook | Public |
| WS | /socket.io | Real-time updates | User |

---

### 4. üß† AI Strategy (Real Implementation)

#### **A. AI Recommendation Engine (`/services/ai/recommendation.js`)**
*   **Logic:** Collaborative Filtering + Content-Based Filtering.
*   **Inputs:** User order history, time of day (Breakfast vs Dinner), current weather (optional), peer group trends.
*   **Output:** Ranked list of `restaurantIds` tailored to the user.

#### **B. Smart Search (Vector Search)**
*   **Tech:** MongoDB Atlas Search (Lucene) or simple Regex with fuzzy matching for MVP.
*   **Feature:** NLP processing of queries like "Spicy chicken under $20".

#### **C. AI Chat Assistant (OpenAI Wrapper)**
*   **Role:** Help uncertain users pick food. "I want something healthy but filling."
*   **Action:** Returns structured JSON of menu items matching description.

---

### 5. üé® Frontend Component Hierarchy (Atomic Design)
*   **Atoms:** `Button`, `Input`, `Badge`, `Icon` (Neon variants).
*   **Molecules:** `RestaurantCard`, `MenuItem`, `CartItem`, `SearchBar`.
*   **Organisms:** `NavBar`, `MenuSection`, `checkoutForm`, `OrderTracker`.
*   **Templates:** `MainLayout`, `AuthLayout`, `DashboardLayout`.
*   **Pages:** `Home`, `RestaurantDetails`, `Cart`, `Profile`, `OrderTracking`.

**Design System Tokens:**
*   **Colors:** `Neon Primary (#00f3ff)`, `Dark Surface (#0f172a)`, `Glass White (rgba(255,255,255,0.1))`
*   **Typography:** `Outfit` (Headings), `Inter` (Body).

---

### 6. üõ°Ô∏è Security & Production Readiness
*   **Rate Limiting:** `express-rate-limit` on all auth routes.
*   **Helmet Headers:** Secure HTTP headers.
*   **Sanitization:** `express-mongo-sanitize` to prevent injection.
*   **Validation:** `Joi` or `Zod` for all request bodies.
*   **Logs:** `Winston` logging to file/CloudWatch.
*   **Environment:** Strict `.env` separation.

---
